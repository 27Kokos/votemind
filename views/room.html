<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Комната — VoteMind</title>
  <!-- Только кастомные стили — НЕТ Tailwind -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/light-theme.css">
  <link rel="stylesheet" href="/css/header.css">
  <link rel="stylesheet" href="/css/room.css">
  <link rel="stylesheet" href="/css/notifications.css">
  <link rel="stylesheet" href="/css/adaptive.css">
</head>
<body>

  <!-- Хедер (единый для всех страниц) -->
  <header>
    <div class="header-wrapper relative">
      <div class="header-border-frame">
        <div class="header-container">
          <a href="/dashboard" class="font-bold">VoteMind</a>
          <div class="flex-between" style="gap: 12px;">
            <a href="#" class="relative" onclick="window.toggleNotifications(event)">
              <i class="fas fa-bell text-base hover:text-indigo-600"></i>
              <span id="notification-badge" class="hidden absolute -top-1 -right-1 bg-indigo-600 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">0</span>
            </a>
            <a href="#" class="ml-3" onclick="toggleTheme(event)">
              <i id="theme-icon" class="fas fa-moon"></i>
            </a>
            <a href="/profile" class="flex-between hover:bg-gray-100 px-2 py-1 rounded-lg" style="gap: 6px;">
              <img id="header-avatar" src="/img/default-avatar.png" class="avatar" alt="Профиль">
              <span class="text-xs font-medium">Профиль</span>
            </a>
            <a href="/auth/logout" class="text-xs text-red-600 hover:text-red-800">Выйти</a>
          </div>
        </div>
      </div>

      <!-- Меню уведомлений -->
      <div id="notifications-menu" class="glass hidden w-80 rounded-xl shadow-xl z-50 overflow-hidden">
        <div class="p-3 border-b border-white/30 text-sm font-medium text-gray-700">Уведомления</div>
        <div id="notifications-list">
          <div class="p-3 text-gray-500 text-sm">Загрузка...</div>
        </div>
      </div>
    </div>
  </header>

  <div class="spacer" style="height: 80px;"></div>

  <main class="container mt-8">
    <!-- Инфо о комнате -->
    <div class="card p-6 mb-6">
      <h2 class="section-title group flex items-center justify-between">

  <span class="flex items-center gap-2">
    <i class="fas fa-door-open"></i>
    <span id="room-name">Загрузка...</span>
  </span>
  <button 
  id="delete-room-btn" 
  class="w-7 h-7 rounded-full bg-red-600 hover:bg-red-700 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-200 shadow-md hover:shadow-lg"
  title="Удалить комнату"
  style="font-size: 0.8rem;"
>
  <i class="fas fa-times"></i>
</button>

</h2>

      <p class="text-gray-300 text-lg mb-4" id="room-desc"></p>
      <div class="flex items-center gap-2 text-sm text-gray-400 group">
        <i class="fas fa-key"></i>
        Код доступа: 
        <strong id="room-code" class="text-indigo-300 font-medium">AB12CD</strong>
        <button 
          onclick="copyInviteLink(event)" 
          class="copy-link-btn opacity-0 group-hover:opacity-100 transition-all"
          title="Скопировать ссылку-приглашение">
          <i class="fas fa-copy text-xs"></i>
        </button>
      </div>



    <!-- Назад -->
    <a href="/dashboard" class="btn-back mb-6">
      <i class="fas fa-arrow-left"></i>
      <span>Назад в кабинет</span>
    </a>


    <!-- Кнопки управления -->
    <div class="room-actions">
      <button id="create-poll-button" class="room-btn" onclick="openCreatePollModal()">
        <i class="fas fa-poll"></i> Создать голосование
      </button>
      <button id="propose-poll-button" class="room-btn propose" onclick="openProposeModal()">
        <i class="fas fa-lightbulb"></i> Предложить голосование
      </button>
      <button id="manage-proposals" class="room-btn" onclick="openProposalsModal()">
        <i class="fas fa-hand-paper"></i> Управление предложениями
      </button>
    </div>

    <!-- Список голосований -->
    <div id="polls-list" class="polls-container">
      <p class="text-gray-500">Загрузка голосований...</p>
    </div>
  </main>

  <!-- Модалки -->

  <!-- 1. Создание голосования -->
  <div id="create-poll-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Создать голосование</h2>
        <button onclick="closeCreatePollModal()" class="modal-close">&times;</button>
      </div>
      <form id="create-poll-modal-form" class="modal-form">
        <div class="form-group">
          <label class="form-label">Вопрос</label>
          <input type="text" id="poll-question" class="form-input" placeholder="Что думаете?" required>
        </div>
        <div class="form-group">
          <label class="form-label">Тип</label>
          <select id="poll-type" class="form-select">
            <option value="single">Один вариант</option>
            <option value="multiple">Несколько</option>
            <option value="rated_options">Оценить каждый (1–5)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Варианты</label>
          <div id="options-inputs" class="form-options">
            <input type="text" class="form-input" placeholder="Вариант 1" required>
            <input type="text" class="form-input" placeholder="Вариант 2" required>
          </div>
          <button type="button" onclick="addOption()" class="btn-modal add">+ Добавить</button>
        </div>
        <div class="modal-btns">
          <button type="button" onclick="closeCreatePollModal()" class="btn-modal cancel">Отмена</button>
          <button type="submit" class="btn-modal save">Создать</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 2. Просмотр голосования -->
  <div id="poll-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Голосование</h2>
        <button onclick="closePollModal()" class="modal-close">&times;</button>
      </div>
      <div id="poll-content">
        <p class="text-gray-400">Загрузка...</p>
      </div>
    </div>
  </div>

  <!-- 3. Редактирование -->
  <div id="edit-poll-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Редактировать</h2>
        <button onclick="closeEditPollModal()" class="modal-close">&times;</button>
      </div>
      <form id="edit-poll-form" class="modal-form">
        <input type="hidden" id="edit-poll-id">
        <div class="form-group">
          <label class="form-label">Вопрос</label>
          <input type="text" id="edit-poll-question" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label">Тип</label>
          <select id="edit-poll-type" class="form-select" disabled>
            <option value="single">Один вариант</option>
            <option value="multiple">Несколько</option>
            <option value="rated_options">Оценить каждый (1–5)</option>
          </select>
          <p class="text-xs text-gray-500 mt-1">Тип нельзя изменить.</p>
        </div>
        <div class="form-group">
          <label class="form-label">Варианты</label>
          <div id="edit-options-inputs" class="form-options"></div>
          <button type="button" onclick="addEditOption()" class="btn-modal add">+ Добавить</button>
        </div>
        <div class="modal-btns">
          <button type="button" onclick="closeEditPollModal()" class="btn-modal cancel">Отмена</button>
          <button type="submit" class="btn-modal save">Сохранить</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 4. Предложить голосование -->
  <div id="propose-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Предложить голосование</h2>
        <button onclick="closeProposeModal()" class="modal-close">&times;</button>
      </div>
      <form id="propose-form" class="modal-form">
        <input type="hidden" id="propose-room-id">
        <div class="form-group">
          <label class="form-label">Вопрос</label>
          <input type="text" id="propose-question" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label">Тип</label>
          <select id="propose-type" class="form-select">
            <option value="single">Один вариант</option>
            <option value="multiple">Несколько</option>
            <option value="rated_options">Оценить каждый (1–5)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Варианты</label>
          <div id="propose-options" class="form-options">
            <input type="text" class="form-input" placeholder="Вариант 1" required>
            <input type="text" class="form-input" placeholder="Вариант 2" required>
          </div>
          <button type="button" onclick="addProposeOption()" class="btn-modal add">+ Добавить</button>
        </div>
        <div class="modal-btns">
          <button type="button" onclick="closeProposeModal()" class="btn-modal cancel">Отмена</button>
          <button type="submit" class="btn-modal save">Отправить</button>
        </div>
      </form>
    </div>
  </div>

  <!-- 5. Просмотр предложений -->
  <div id="proposal-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Новые предложения</h2>
        <button onclick="closeProposalModal()" class="modal-close">&times;</button>
      </div>
      <div id="proposal-content">
        <p class="text-gray-400">Загрузка...</p>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="/js/room.js"></script>
  <script src="/js/notifications.js"></script>
  <script src="/js/header.js"></script>
</body>
</html>
